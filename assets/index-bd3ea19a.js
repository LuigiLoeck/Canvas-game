(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))d(h);new MutationObserver(h=>{for(const r of h)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&d(o)}).observe(document,{childList:!0,subtree:!0});function t(h){const r={};return h.integrity&&(r.integrity=h.integrity),h.referrerPolicy&&(r.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?r.credentials="include":h.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(h){if(h.ep)return;h.ep=!0;const r=t(h);fetch(h.href,r)}})();const m=async i=>new Promise(e=>{const t=new Image;t.addEventListener("load",()=>(console.log("loaded: "+i),e(t))),t.src=i,console.log("loading img: "+i)}),c=async i=>new Promise(e=>{const t=new Audio(i);return console.log("loading audio..."),t.addEventListener("canplaythrough",()=>(console.log("Audio loaded: "+i),e(t)))}),n={SITTING:0,RUNNING:1,JUMPING:2,FALLING:3,ATTACKING:4,HIT:5};class g{constructor(e){this.state=e}}class T extends g{constructor(e){super("SITTING"),this.player=e}enter(){this.player.frameX=0,this.player.maxFrame=3,this.player.frameY=2}handleInput(e){e.includes("a")||e.includes("d")?this.player.setState(n.RUNNING,1):e.includes(" ")?this.player.isAttacking||(this.player.isAttacking=!0,this.player.setState(n.ATTACKING,2)):e.includes(" ")?e.includes("w")&&this.player.setState(n.JUMPING,1):this.player.isAttacking=!1}}class A extends g{constructor(e){super("RUNNING"),this.player=e}enter(){this.player.frameX=0,this.player.maxFrame=5,this.player.frameY=4}handleInput(e){e.includes("s")?this.player.setState(n.SITTING,0):e.includes("w")?this.player.setState(n.JUMPING,1):e.includes(" ")?this.player.isAttacking||(this.player.isAttacking=!0,this.player.setState(n.ATTACKING,2)):e.includes(" ")||(this.player.isAttacking=!1)}}class N extends g{constructor(e){super("JUMPING"),this.player=e}enter(){this.player.frameX=0,this.player.onGround()&&(this.player.vy-=30),this.player.maxFrame=3,this.player.frameY=3}handleInput(e){this.player.vy>this.player.weight?this.player.setState(n.FALLING,1):e.includes(" ")?this.player.isAttacking||(this.player.isAttacking=!0,this.player.setState(n.ATTACKING,2)):e.includes(" ")||(this.player.isAttacking=!1)}}class G extends g{constructor(e){super("FALLING"),this.player=e}enter(){this.player.frameX=4,this.player.maxFrame=1,this.player.frameY=3}handleInput(e){this.player.onGround()&&this.player.setState(n.RUNNING,1)}}class b extends g{constructor(e){super("ATTACKING"),this.player=e}enter(){this.player.frameX=0,this.player.maxFrame=5,this.player.frameY=0}handleInput(e){this.player.frameX>=this.player.maxFrame&&this.player.onGround()?this.player.setState(n.RUNNING,1):this.player.frameX>=this.player.maxFrame&&!this.player.onGround()?this.player.setState(n.FALLING,1):e.includes("w")&&this.player.onGround()&&(this.player.vy-=25)}}class F extends g{constructor(e){super("HIT"),this.player=e}enter(){this.player.frameX=0,this.player.maxFrame=5,this.player.frameY=1}handleInput(e){this.player.frameX>=5&&this.player.onGround()?this.player.setState(n.RUNNING,1):this.player.frameX>=5&&!this.player.onGround()&&this.player.setState(n.FALLING,1)}}class M{constructor(e){this.game=e,this.width=136,this.height=182.6,this.x=0,this.y=this.game.height-this.height-this.game.groundMargin,this.vy=0,this.weight=1;const t=new Image;t.src=e.selectedCharacter,this.image=t,this.frameX=0,this.frameY=0,this.maxFrame,this.fps=10,this.frameInterval=1e3/this.fps,this.frameTimer=0,this.speed=0,this.maxSpeed=5,this.states=[new T(this),new A(this),new N(this),new G(this),new b(this),new F(this)],this.currentState=this.states[0],this.currentState.enter(),this.isAttacking=!1,this.attackCounter=0,this.maxAttackCounter=3}update(e,t){this.checkCollision(),this.currentState.handleInput(e),this.x+=this.speed,e.includes("d")&&this.currentState!==this.states[5]?this.speed=this.maxSpeed:e.includes("a")&&this.currentState!==this.states[5]?this.speed=-this.maxSpeed:this.speed=0,this.x<0&&(this.x=0),this.x>this.game.width-this.width&&(this.x=this.game.width-this.width),this.y+=this.vy,this.onGround()?this.vy=0:this.vy+=this.weight,this.frameTimer>this.frameInterval?(this.frameTimer=0,this.frameX<this.maxFrame?this.frameX++:this.currentState===this.states[4]?this.setState(states.RUNNING,1):this.frameX=0):this.frameTimer+=t}draw(e){this.game.debug&&e.strokeRect(this.x,this.y,this.width,this.height),e.drawImage(this.image,this.frameX*(this.width+40),this.frameY*this.height,this.width,this.height,this.x,this.y,this.width,this.height)}onGround(){return this.y>=this.game.height-this.height-this.game.groundMargin}setState(e,t){this.currentState=this.states[e],this.game.speed=this.game.maxSpeed*t,this.currentState.enter()}checkCollision(){this.game.enemies.forEach(e=>{this.x+this.width>e.x&&this.x<e.x+e.width&&this.y+this.height>e.y&&this.y<e.y+e.height&&(e.markedForDeletion=!0,this.currentState===this.states[4]?(this.game.score++,this.game.sound.enemy.pause(),this.game.sound.enemy.currentTime=0,this.game.sound.enemy.play()):this.currentState!==this.states[5]&&(this.game.lifes--,this.setState(5,0),this.game.sound.hurt.play()))})}}class v{constructor(e){this.game=e,this.keys=[],window.addEventListener("keydown",t=>{console.log(t.key),(t.key==="s"||t.key==="w"||t.key==="a"||t.key==="d"||t.key===" ")&&this.keys.indexOf(t.key)===-1?this.keys.push(t.key):t.key==="h"&&(this.game.debug=!this.game.debug)}),window.addEventListener("keyup",t=>{const d=this.keys.indexOf(t.key);d!==-1&&this.keys.splice(d,1)})}}class L{constructor(e,t,d,h,r){this.game=e,this.width=t,this.height=d,this.speedModifier=h,this.image=r,this.x=0,this.y=0}update(){this.x<-this.width?this.x=0:this.x-=this.game.speed*this.speedModifier}draw(e){e.drawImage(this.image,this.x,this.y,this.width,this.height),e.drawImage(this.image,this.x+this.width,this.y,this.width,this.height)}}class E{constructor(e){switch(this.game=e,this.width=1667,this.height=793,this.layerMax=0,this.velocity=.2,this.backgroundLayers=[],this.background=e.selectedBackground,this.background){case"forest1":this.layerMax=12,this.velocity=1/(this.layerMax-2);break;case"forest2":this.layerMax=6,this.game.groundMargin=100,this.velocity=1/(this.layerMax-1);break;case"desert":this.layerMax=5,this.game.groundMargin=40,this.velocity=1/(this.layerMax-1);break;case"gardens":this.layerMax=7,this.game.groundMargin=60,this.velocity=1/(this.layerMax-1);break}for(let t=1;t<=this.layerMax;t++)this.img=new Image,this.img.src="./background/"+this.background+"/layer"+t+".png",this.backgroundLayers.push(new L(this.game,this.width,this.height,(t-1)*this.velocity,this.img));console.log(this.backgroundLayers)}update(){this.backgroundLayers.forEach(e=>e.update())}draw(e){this.backgroundLayers.forEach(t=>t.draw(e))}}class u{constructor(){this.frameX=0,this.frameY=0,this.fps=20,this.frameInterval=1e3/this.fps,this.frameTimer=0,this.markedForDeletion=!1}update(e){this.x-=this.speedX+this.game.speed,this.y+=this.speedY,this.frameTimer>this.frameInterval?(this.frameTimer=0,this.frameX<this.maxFrame?this.frameX++:this.frameX=0):this.frameTimer+=e,this.x+this.width<0&&(this.markedForDeletion=!0)}draw(e){this.game.debug&&e.strokeRect(this.x,this.y,this.width,this.height),e.drawImage(this.image,this.frameX*this.width,0,this.width,this.height,this.x,this.y,this.width,this.height)}}class X extends u{constructor(e){super(),this.game=e,this.width=96,this.height=96,this.x=this.game.width+Math.random()*this.game.width*.5,this.y=Math.random()*this.game.height*.5,this.speedX=Math.random()+1,this.speedY=0,this.maxFrame=3;const t=new Image;t.src="./enemies/enemy_fly2.png",this.image=t,this.angle=0,this.va=Math.random()*.1+.1}update(e){super.update(e),this.angle+=this.va,this.y+=Math.sin(this.angle)}}class C extends u{constructor(e){super(),this.game=e,this.width=96,this.height=96,this.x=this.game.width,this.y=this.game.height-this.height-this.game.groundMargin,this.speedX=0,this.speedY=0,this.maxFrame=3;const t=new Image;t.src="./enemies/enemy_plant2.png",this.image=t}}class $ extends u{constructor(e){super(),this.game=e,this.width=97.3,this.height=144,this.x=this.game.width,this.y=Math.random()*this.game.height*.5;const t=new Image;t.src="./enemies/enemy_spider.png",this.image=t,this.speedX=0,this.speedY=Math.random()>.5?1:-1,this.maxFrame=2}update(e){super.update(e),this.y>this.game.height-this.height-this.game.groundMargin&&(this.speedY*=-1),this.y<-this.height&&(this.markedForDeletion=!0)}draw(e){this.game.debug&&e.strokeRect(this.x,this.y,this.width,this.height),e.drawImage(this.image,this.frameX*(this.width+120)+60,0,this.width,this.height,this.x,this.y,this.width,this.height),e.beginPath(),e.moveTo(this.x+this.width/2,0),e.lineTo(this.x+this.width/2,this.y+50),e.stroke()}}class Y{constructor(e){this.game=e,this.fontSize=30,this.fontFamily="sans-serif"}draw(e){console.log(this.game.time),this.game.time<3e3&&(e.textAlign="center",e.font=`${this.fontSize*2}px ${this.fontFamily}`,e.fillStyle="#000b",e.fillRect(0,0,this.game.width,this.game.height),e.fillStyle="#fff",e.fillText("Goal: 25 points",this.game.width/2,this.game.height/2)),e.font=`${this.fontSize}px ${this.fontFamily}`,e.textAlign="left",e.fillStyle=this.game.fontColor,e.fillText(`Score: ${this.game.score}`,20,50),e.fillText(`Lives: ${this.game.lifes}`,20,100),e.textAlign="right",e.fillText(`Game Time: ${23-Math.floor(this.game.time/1e3)}`,this.game.width-20,50),this.game.gameOver&&(this.game.sound.theme.pause(),e.textAlign="center",e.font=`${this.fontSize*2}px ${this.fontFamily}`,e.fillStyle="#000b",e.fillRect(0,0,this.game.width,this.game.height),e.fillStyle="#fff",this.game.score>25?(e.fillText("Victory!",this.game.width/2,this.game.height/2),this.game.sound.win.play()):(this.game.lifes==0?e.fillText("You are dead!",this.game.width/2,this.game.height/2):e.fillText("Time is over!",this.game.width/2,this.game.height/2),this.game.sound.loss.play()),e.font=`${this.fontSize*.7}px ${this.fontFamily}`,e.fillText(`Score: ${this.game.score}`,this.game.width/2,this.game.height/1.8),e.fillText(`Lives: ${this.game.lifes}`,this.game.width/2,this.game.height/1.7),e.font=`${this.fontSize*1}px ${this.fontFamily}`,e.fillText("Press enter to restart",this.game.width/2,this.game.height/1.5))}}window.addEventListener("load",function(){const i=document.getElementById("canvas1"),e=i.getContext("2d");i.width=800,i.height=793;const t=document.getElementById("selectionScreen"),d=document.querySelectorAll('input[name="player"]'),h=document.querySelectorAll('input[name="background"]'),r=document.getElementById("startButton");let o,f,y;r.addEventListener("click",()=>{d.forEach(s=>{s.checked&&(f=s.id)}),h.forEach(s=>{s.checked&&(y=s.id)}),t.style.display="none",o=new I(i.width,i.height,f,y),k(0)});for(let s=1;s<13;s++)m("./background/forest1/layer"+s+".png");for(let s=1;s<7;s++)m("./background/forest2/layer"+s+".png");for(let s=1;s<6;s++)m("./background/desert/layer"+s+".png");for(let s=1;s<8;s++)m("./background/gardens/layer"+s+".png");m("./enemies/enemy_fly2.png"),m("./enemies/enemy_plant2.png"),m("./enemies/enemy_spider.png"),m("./player.png"),m("./player2.png"),c("./sounds/theme.mp3"),c("./sounds/hurt.mp3"),c("./sounds/loss.mp3"),c("./sounds/win.mp3"),c("./sounds/enemy.mp3");class I{constructor(a,l,x,S){this.width=a,this.height=l,this.selectedCharacter=x,this.selectedBackground=S,this.groundMargin=80,this.speed=0,this.maxSpeed=2,this.background=new E(this),this.player=new M(this),this.input=new v(this),this.ui=new Y(this),this.enemies=[],this.enemyTimer=0,this.enemyInterval=1e3,this.debug=!1,this.score=0,this.fontColor="white",this.player.currentState=this.player.states[0],this.player.currentState.enter(),this.time=0,this.maxTime=23e3,this.lifes=3,this.gameOver=!1,this.sound={theme:new Audio("./sounds/theme.mp3"),hurt:new Audio("./sounds/hurt.mp3"),loss:new Audio("./sounds/loss.mp3"),win:new Audio("./sounds/win.mp3"),enemy:new Audio("./sounds/enemy.mp3")},this.sound.theme.loop=!0,this.sound.theme.volume=.25,this.sound.theme.play()}update(a){this.time+=a,(this.time>this.maxTime||this.lifes==0)&&(this.gameOver=!0),this.background.update(),this.player.update(this.input.keys,a),this.time>3e3&&(this.enemyTimer>this.enemyInterval?(this.enemyTimer=0,this.addEnemy()):this.enemyTimer+=a,this.enemies.forEach(l=>{l.update(a),l.markedForDeletion&&this.enemies.splice(this.enemies.indexOf(l),1)}))}draw(a){this.background.draw(a),this.player.draw(a),this.enemies.forEach(l=>l.draw(a)),this.ui.draw(a)}addEnemy(a){this.speed>0&&Math.random()<.5?this.enemies.push(new C(this)):this.speed>0&&this.enemies.push(new $(this)),this.enemies.push(new X(this))}}let p=0,w=10;function k(s){const a=s-p;p=s,w+=a,w>a*2.4&&(e.clearRect(0,0,i.width,i.height),o.update(a),o.draw(e)),o.gameOver?window.addEventListener("keydown",function(l){console.log(l.code),l.code==="Enter"&&window.location.reload()}):requestAnimationFrame(k)}});
